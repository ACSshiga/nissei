# 現在のIssue・優先度・ブロッカー

**最終更新**: 2025-10-02

## 🚨 最優先課題（Critical）

### 1. 仕様の齟齬を解消する

**状況**:
- 要件定義書（docs/requirements-definition.md）と実装が大きく乖離
- 要件定義: シンプルな案件管理（名前、説明、ステータス、日付、工数）
- 実装: 製造業・機械設計向けの専門的な仕様（管理No、機番、機種シリーズ、世代、トン数、仕様タグ、進捗マスタ、作業区分マスタ、問い合わせマスタなど）

**ユーザーからの情報**:
- 業務フロー: PDF（docs/2025-9-22.pdf）から案件情報を読み込み → 全体管理画面 → 担当者画面（自動同期、管理No順）→ 工数入力・進捗入力

**未確認事項**:
1. **案件管理画面の仕様**:
   - 管理No、機番、機種シリーズ、世代、トン数、仕様タグは必要か？
   - 進捗マスタ、作業区分マスタ、問い合わせマスタは必要か？
   - 仕掛日、完了日、作図期限は必要か？

2. **PDFの取り込み方法**:
   - 手動入力？自動読み取り？
   - 現時点では手動入力でOK？

3. **担当者管理**:
   - 1案件に複数の担当者をアサイン可能？
   - それとも1案件=1担当者？

4. **進捗管理**:
   - マスタで管理（受注済み、作図中、完成など）？
   - カスタマイズ可能にする？

5. **工数入力の粒度**:
   - 日単位？時間単位？
   - 開始時刻・終了時刻は必要？

**次のアクション**:
- ユーザーに上記5項目について確認
- 確認後、要件定義書を更新するか、実装を修正するか決定

---

## ⚠️ ブロックされている課題

### Supabaseスキーマキャッシュ問題（E2Eテスト中断中）

**状況**:
- バックエンドのSupabaseクライアントが `work_logs` テーブルを認識しない
- エラー: `"Could not find the table 'public.work_logs' in the schema cache"`
- Supabase MCP（別接続）では `work_logs` テーブルを正しく認識

**試した解決策**:
- ✅ マイグレーション適用（backend/migrations/2025-10-02_create_all_tables.sql）
- ✅ バックエンドコンテナ再起動（複数回）
- ✅ 全コンテナ再起動
- ❌ スキーマキャッシュのリフレッシュ（Supabase側の操作が必要）

**解決方法**:
- Option A: Supabase Studioでスキーマをリフレッシュ（推奨）
- Option B: E2Eテストをスキップして、コードレベル検証に切り替え

**影響**:
- 工数入力画面のE2Eテストが中断中
- 現時点で完了した作業:
  - ✅ データベースリセット完了
  - ✅ ログイン機能テスト成功
  - ✅ UI経由でのプロジェクト作成成功

---

## 📋 進行中のタスク

### Phase 1実装状況

| 項目 | 状態 | 備考 |
|-----|------|------|
| マスタ管理機能 | ✅ 完了 | 進捗・作業区分・問い合わせマスタ |
| 案件管理強化 | ⚠️ 仕様確認待ち | 上記の仕様齟齬を解消後に再開 |
| 工数グリッドUI | ❌ 未着手 | 仕様確定後に実装 |

---

## 🎯 次のステップ（優先度順）

### 1. 仕様確認ミーティング（最優先）

ユーザーに以下を確認:
1. 案件管理画面に必要な項目
2. PDFの取り込み方法（自動/手動）
3. 担当者管理の仕様
4. 進捗管理の仕様
5. 工数入力の粒度

### 2. Supabaseスキーマキャッシュ問題の解決

- Supabase Studioでスキーマをリフレッシュ
- または、コードレベル検証に切り替え

### 3. 要件定義書の更新 or 実装の修正

仕様確認後、以下のいずれかを実施:
- Option A: 要件定義書を現在の実装に合わせて更新
- Option B: 実装を要件定義書に合わせてシンプル化

### 4. Phase 1の継続

仕様確定後:
- 案件管理強化の再開
- 工数グリッドUI実装

---

## 📌 記録事項

### 最近のPR・マージ履歴

- #33: usersテーブルのpasswordカラム名をhashed_passwordに統一
- #32: 工数入力APIにstart_time/end_timeフィールドを追加
- #31: Supabaseマイグレーションでwork_logsテーブルに必須カラムを追加
- #21: 工数入力画面をスプレッドシート風UIに全面改修

### git status（セッション開始時）

```
Current branch: main
Modified: CLAUDE.md
Deleted: ai-rules/CODE_REVIEW.md, MCP_USAGE.md, PR_GUIDELINES.md, PR_MERGE_PROCESS.md
Modified: ai-rules/README.md, WORKFLOW.md
Untracked: ai-rules/PR_AND_REVIEW.md, SETUP_AND_MCP.md
```

→ ai-rulesディレクトリの再編成中（ドキュメント統合）

---

## 💡 メモ

- PDFファイル（docs/2025-9-22.pdf）の読み込みがコンテキスト制限に引っかかった
- → テキストベースで仕様を確認する必要がある
- ユーザーは「仕様の打合せが必要」と認識している
