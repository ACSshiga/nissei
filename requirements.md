# 工数管理システム 要件定義書（MVP版）

## 1. 利用者と認証

### 対象ユーザー
- 社内の設計者のみ（外注なし）

### 認証
- 独自認証（メール＋パスワード、簡易）
- Google連携は不要

### 権限
- 全員が全案件を見られる
- 請求確定操作のみ誤操作防止のため限定ロール設定を検討（既定は全員可）

## 2. 業務フロー

1. 案件依頼書（PDF）受領
2. システムにPDFをアップロード → 案件が自動登録
3. 案件ごとに工数を担当者が日々入力
4. 月末に請求を締めてExcel出力
5. 必要な資料・注意点を案件詳細から参照・追加
6. ダッシュボードで進捗・工数・未完チェック項目を可視化

## 3. データ構造

### 案件（Project）
- 管理No
- 機種（シリーズ, 世代, トン数, 仕様タグ）
- 機番
- 業務委託内容（申請書から）
- 問い合わせ（問い合わせマスタから単一選択）
- 作業区分（マスタ参照）
- 予定工数
- 実績工数（自動集計）
- ステータス（進捗マスタ）
- 仕掛日／完了日／作図期限
- 資料リンク（機番/機種ごと）
- 注意点チェックリスト

### 工数（WorkLog）
- 案件ID
- 日付
- 入力時間（分単位）
- 作業区分
- メモ
- 登録者・更新日時

### 請求（Invoice）
- 請求バッチ（年月, 実行者, 実行日）
- 請求出力：管理No／業務委託内容／実工数（時間・小数）

### 資料（Material）
- 種別：機種／機番
- Key（機種名 or 機番）
- タイトル
- 種類：URL or ファイル
- 保存先（S3互換）
- 登録者・登録日

### 注意点（Checklist）
- テンプレート（カテゴリ＝機種タグ、タイトル、重要度、補足コメント）
- 案件別項目（案件ID, ステータス, 完了者, 完了日, メモ）

### マスタ
- 担当者
- 進捗
- 問い合わせ（単一選択）
- 作業区分

## 4. 機能要件

### 案件管理
- PDF取込で案件登録（管理No, 機種, 機番などを自動抽出）
- 重複チェック（管理No）
- 詳細画面：基本情報＋工数＋資料＋注意点

### 工数入力
- 月グリッドUI（Excel風）
- 行：案件、列：日付（1〜31）
- セルに小数時間入力（0.25単位）
- 合計行／列は自動計算
- Excel/スプレッドシートからのコピー貼付可
- 範囲一括入力、加算ショートカット（=+0.25）

### 請求
- 月末に対象案件を集計
- Excel出力（3列固定：管理No／業務委託内容／実工数(時間, 小数)）
- 締め確定処理（以降の工数編集はロック）

### 資料管理
- 案件の機種／機番に紐づく資料一覧
- URL or ファイルを追加可（誰でも）
- 検索・プレビュー対応

### 注意点チェックリスト
- 案件作成時に機種カテゴリに基づき自動展開
- 必須項目は請求時に未完なら警告
- 自由追記→必要ならテンプレに昇格可能

### ダッシュボード
- 個人の今月工数
- 全体工数
- 案件数・進捗分布
- 今週期限の案件
- 注意点の未完件数

## 5. 非機能要件

- **モバイル対応**：スマホからも工数入力可
- **小規模利用**：社内数十人想定
- **冗長性**：DB日次バックアップ90日保持、監査ログ1年保持
- **セキュリティ**：独自認証（8桁パスワード以上）、将来2段階認証追加可能

## 6. 技術スタック（採用）

- **フロントエンド**: Next.js 14 (App Router) + TypeScript + Tailwind CSS + shadcn/ui
- **バックエンド**: FastAPI + Python 3.11
- **データベース**: PostgreSQL 15
- **ORM**: SQLAlchemy
- **認証**: JWT (jose)
- **ファイルストレージ**: MinIO (S3互換)
- **OCR**: Tesseract + PyPDF2
- **Excel出力**: openpyxl
- **開発環境**: Docker Compose

## 7. 初期データ移行

- テストシート.xlsx → 案件基本データ／工数フォーマット参照
- 資料作成注意点一覧.xlsx → 注意点テンプレート化
- 既存Billing.gs → 請求ロジックを再設計（3列出力仕様に簡略化）

## 8. ポート設定

- **フロントエンド**: http://localhost:3000 (ポート: 3000)
- **バックエンド API**: http://localhost:8000 (ポート: 8000)
- **PostgreSQL**: ポート 5432
- **MinIO**: ポート 9000 (API), 9001 (Console)