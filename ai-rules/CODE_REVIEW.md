# コードレビューガイドライン

## Codexレビューの実施（必須）

### タイミング
⚠️ **PR作成直後に必ず実施**

### 手順

1. **PR作成**
   - GitHub PRを作成

2. **Codexレビュー依頼**
   ```
   @codex review
   ```
   - MCP GitHub APIの `add_issue_comment` を使用
   - PRにコメントとして投稿

3. **Discord通知**
   - Codexのレビューコメントは自動的にDiscordの `#github-notifications` チャンネルへ通知される

4. **レビュー確認**
   - Codexからのフィードバックを確認
   - 指摘事項があれば対応

5. **修正対応**
   - 必要に応じて修正をコミット・プッシュ
   - 修正後は再度 `@codex review` でレビュー依頼（必要に応じて）

6. **マージ**
   - Codexレビューが承認されたらmainブランチへマージ

## レビュー観点

### セキュリティ
- [ ] 認証・認可が適切に実装されている
- [ ] 機密情報がハードコードされていない
- [ ] 入力値の検証が行われている
- [ ] SQLインジェクション対策がされている

### パフォーマンス
- [ ] N+1クエリが発生していない
- [ ] 不要なデータ取得をしていない
- [ ] キャッシュが適切に利用されている
- [ ] 大量データ処理でメモリリークがない

### コード品質
- [ ] 命名規則に準拠している
- [ ] 適切な関数・クラス分割がされている
- [ ] 重複コードがない（DRY原則）
- [ ] 適切なエラーハンドリングがされている
- [ ] コメントが必要な箇所に記載されている

### テスト
- [ ] E2Eテストが実装されている
- [ ] 正常系・異常系のテストがある
- [ ] エッジケースが考慮されている

### ドキュメント
- [ ] README/ドキュメントが更新されている
- [ ] APIドキュメントが更新されている（API変更時）
- [ ] 複雑なロジックにコメントがある

## レビューコメントの対応

### 優先度の判断

- **Critical（必須対応）**: セキュリティ、バグ、データ破損のリスク
- **Important（推奨対応）**: パフォーマンス、保守性の大幅改善
- **Nice to have（検討）**: より良い実装方法の提案

### 返信のガイドライン

1. **対応した場合**
   ```
   ご指摘ありがとうございます。
   [修正内容の説明]
   コミット: [コミットハッシュ]
   ```

2. **対応しない場合**
   ```
   ご提案ありがとうございます。
   [対応しない理由]
   今回は[代替案]で進めさせていただきます。
   ```

3. **質問がある場合**
   ```
   ご指摘の件について確認させてください。
   [具体的な質問]
   ```

## セルフレビュー（Codexレビュー前）

PR作成前に自分でチェック：

- [ ] 変更内容を再確認
- [ ] 不要なコメントやデバッグコードを削除
- [ ] コンソールログを削除
- [ ] フォーマットが統一されている
- [ ] 不要なファイルが含まれていない
- [ ] .gitignoreが適切に設定されている

## レビュー後のアクション

### 承認された場合
1. mainブランチへマージ
2. 作業ブランチを削除

### 修正が必要な場合
1. 指摘事項を修正
2. コミット・プッシュ
3. 必要に応じて再レビュー依頼

### 議論が必要な場合
1. PRコメントで議論
2. 必要に応じてチームメンバーに相談
3. 方針決定後に修正・マージ

## 注意事項

- **mainブランチへのマージ前には必ずCodexレビューを実施**
- レビュー指摘を無視してマージしない
- 重大な指摘は必ず対応してからマージ
- 軽微な指摘でも次回以降は改善する
